# Ed - Reactive Data Framework for Nim

Ed (formerly model_citizen/Zen) is a reactive data framework for Nim that provides thread-safe and network-synchronized data structures. It's designed to sync data across threads and the network while allowing components to react to changes.

## Project Overview

This library provides "Ed" objects - reactive data containers that can:
- Sync data across multiple threads
- Sync data across network connections
- Track changes and notify subscribers
- Handle complex nested data structures
- Provide automatic serialization/deserialization

## Key Architecture Components

### Core Types (`src/ed/types.nim`)
- **EdContext**: Central coordination object managing object lifecycle, subscriptions, and message passing
- **EdBase**: Base class for all reactive objects
- **Ed[T, O]**: Generic reactive container for type T with change objects of type O
- **EdTable[K, V]**, **EdSeq[T]**, **EdSet[T]**, **EdValue[T]**: Specialized reactive collections
- **Change[O]**: Represents modifications to objects with change tracking
- **Subscription**: Manages local/remote connections for data synchronization

### Key Modules
- **`zens/`**: Core reactive object operations, contexts, initializers, validations
- **`components/`**: Subscription management and type registry
- **`utils/`**: Logging, statistics, type IDs, and miscellaneous utilities

### Testing Structure
- All tests are in `tests/` directory
- Main test runner: `tests/tests.nim`
- Individual test suites: `basic_tests.nim`, `threading_tests.nim`, `network_tests.nim`, `publish_tests.nim`, `object_tests.nim`

## Commit Conventions

- No "Generated by Claude" or "Co-Authored-By" tags in commit messages
- Multiline commits are fine but keep messages short and focused
- Use conventional commit style when appropriate (fix:, feat:, refactor:, etc.)

## Development Commands

### Running Tests
```bash
nimble test
```
This compiles and runs all test suites. Tests pass successfully with some warnings about unused imports.

### Build Configuration
- Uses Nim config in `tests/config.nims` with:
  - ORC memory management (`--mm:orc`)
  - Threading enabled (`--threads:on`)
  - Various debugging flags including `ed_trace` and `metrics`
  - Chronicles logging enabled

### Dependencies
Key dependencies from `model_citizen.nimble`:
- `nim >= 1.4.8`
- `pretty`, `threading`, `chronicles`, `flatty`, `netty`, `supersnappy`
- `nanoid.nim`, `metrics`

## Key Features

### Thread Safety
- Built on Nim's threading system with channels for message passing
- Thread-safe reactive objects that can be shared across threads
- Automatic synchronization of changes between thread contexts

### Network Synchronization
- Objects can sync across network connections using netty
- Remote subscriptions allow distributed reactive programming
- Automatic serialization/deserialization with flatty

### Change Tracking
- Detailed change notifications with `ChangeKind` (CREATED, ADDED, REMOVED, MODIFIED, TOUCHED, CLOSED)
- Reactive callbacks triggered on data modifications
- Change propagation through object hierarchies

### Memory Management
- Reference counting with `CountedRef` for shared objects
- Automatic cleanup of unused references
- Object lifecycle management through EdContext

## Usage Patterns

### Basic Usage
```nim
import ed

Ed.bootstrap

# Create reactive values
let name = ed("hello")
var items = EdSeq[string].init

# Track changes
items.track proc(changes: auto) =
  for change in changes:
    if ADDED in change.changes:
      echo "Added: ", change.item

# Modify data (triggers callbacks)
name.value = "world"
items.add "one"
```

### Cross-Thread Synchronization
```nim
# Set up contexts in different threads
var ctx1 = EdContext.init(id = "thread1")
var ctx2 = EdContext.init(id = "thread2")

# Subscribe for sync
ctx2.subscribe(ctx1)

# Changes in ctx1 objects automatically sync to ctx2
```

## Development Notes

- The codebase uses advanced Nim features like macros, templates, and meta-programming
- Heavy use of `{.gcsafe.}` pragmas for thread safety
- Extensive logging and metrics collection capabilities
- Some deprecation warnings exist (e.g., `newIdentNode` usage)
- Project follows a modular architecture with clear separation of concerns
